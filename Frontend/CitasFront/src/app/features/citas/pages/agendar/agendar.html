<div class="contenedor-agendar animate-fade-in">
    <div class="cabecera">
        <h1 class="seccion-titulo">Agendar Nueva Cita</h1>
        <p class="texto-secundario">Complete los datos del vehículo y seleccione su horario de preferencia.</p>
    </div>

    <mat-card class="tarjeta-formulario">
        <form [formGroup]="formulario" (ngSubmit)="agendar()" class="formulario">

            <div class="grupo-formulario">
                <h3 class="subtitulo-seccion">Información del Vehículo</h3>
                <div class="grid-campos">
                    <mat-form-field appearance="outline">
                        <mat-label>Número de Placa</mat-label>
                        <input matInput formControlName="placa" placeholder="Ej: ABC-123 o ABC-1234" />
                        @if (formulario.get('placa')?.hasError('pattern') && formulario.get('placa')?.touched) {
                        <mat-error>Formato inválido (ABC-123 o ABC-1234)</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Marca</mat-label>
                        <input matInput formControlName="marca" />
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Modelo</mat-label>
                        <input matInput formControlName="modelo" />
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Año</mat-label>
                        <input matInput type="number" formControlName="anio" />
                    </mat-form-field>
                </div>
            </div>

            <div class="grupo-formulario">
                <h3 class="subtitulo-seccion">Detalles de la Cita</h3>
                <div class="grid-campos">
                    <mat-form-field appearance="outline">
                        <mat-label>Seleccione la Fecha</mat-label>
                        <input matInput [matDatepicker]="datepicker" formControlName="fechaCita" [min]="fechaMinima"
                            [matDatepickerFilter]="filtroFecha" (dateChange)="onFechaCambio()" readonly />
                        <mat-datepicker-toggle matSuffix [for]="datepicker"></mat-datepicker-toggle>
                        <mat-datepicker #datepicker></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Seleccione el Horario</mat-label>
                        <mat-select formControlName="horaCita">
                            @for (horario of horarios(); track horario.hora) {
                            <mat-option [value]="horario.hora" [disabled]="!horario.disponible">
                                {{ horario.hora }} {{ !horario.disponible ? '(Ocupado)' : '' }}
                            </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="campo-completo">
                        <mat-label>Descripción o Motivo</mat-label>
                        <textarea matInput formControlName="descripcion" rows="3"></textarea>
                    </mat-form-field>
                </div>
            </div>

            <div class="acciones">
                <button mat-button type="button" (click)="formulario.reset()">Limpiar campos</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="formulario.invalid">
                    Confirmar Agendamiento
                </button>
            </div>
        </form>
    </mat-card>
</div>